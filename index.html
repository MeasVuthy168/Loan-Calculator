<script>
  function exportToExcel() {
    const exportSection = document.getElementById("exportSection");

    if (!exportSection || exportSection.innerHTML.trim() === "") {
      alert("សូមគណនាមុននឹងនាំចេញ។");
      return;
    }

    // Clone content to clean it
    const clone = exportSection.cloneNode(true);
    clone.querySelectorAll("table").forEach(t => {
      t.style.border = "1px solid #000";
    });

    // Combine all table data
    const tables = clone.querySelectorAll("table");
    const wb = XLSX.utils.book_new();
    let data = [];

    tables.forEach((table, idx) => {
      const sheet = XLSX.utils.table_to_sheet(table);
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
      if (idx > 0) data.push([""]); // space between summary & schedule
      data = data.concat(rows);
    });

    const ws = XLSX.utils.aoa_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, "តារាងកាលវិភាគសងប្រាក់");
    XLSX.writeFile(wb, "តារាងកាលវិភាគសងប្រាក់.xlsx");
  }
</script>
